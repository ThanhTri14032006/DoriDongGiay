<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản Lý Khách Hàng | Dori Đông Giày Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/admin-style.css">
    <style>
        .customer-card {
            border: none;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
        }
        .customer-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.12);
        }
        .customer-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid #fff;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f8f9fa;
        }

        .customer-avatar svg {
            width: 100%;
            height: 100%;
        }
        .status-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-weight: 600;
        }
        .customer-info-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 1.5rem;
        }
        .info-item {
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
        }
        .order-history-item {
            border-left: 4px solid #007bff;
            background: #f8f9fa;
            border-radius: 0 8px 8px 0;
            padding: 1rem;
            margin-bottom: 0.75rem;
        }
        .filter-section {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
        }
        .stats-icon {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            opacity: 0.8;
        }
    </style>
</head>
<body>
<div class="wrapper">
    <!-- Header -->
    <div id="header-placeholder"></div>
    <!-- End Header -->

    <!-- Page Content -->
    <div id="content">
        <div class="container-fluid p-4">
            <!-- Page Header -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h2 class="fw-bold text-dark mb-1">
                        <i class="fas fa-users text-primary me-2"></i>
                        Quản Lý Khách Hàng
                    </h2>
                    <p class="text-muted mb-0">Quản lý thông tin chi tiết khách hàng và lịch sử mua hàng</p>
                </div>
                <button class="btn btn-primary btn-lg" data-bs-toggle="modal" data-bs-target="#addCustomerModal">
                    <i class="fas fa-plus me-2"></i>Thêm Khách Hàng
                </button>
            </div>

            <!-- Statistics Cards -->
            <div class="row mb-4">
                <div class="col-md-3 mb-3">
                    <div class="stats-card">
                        <i class="fas fa-users stats-icon"></i>
                        <h3 class="fw-bold mb-1">1,247</h3>
                        <p class="mb-0">Tổng Khách Hàng</p>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="stats-card" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">
                        <i class="fas fa-user-plus stats-icon"></i>
                        <h3 class="fw-bold mb-1">89</h3>
                        <p class="mb-0">Khách Hàng Mới (Tháng)</p>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="stats-card" style="background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);">
                        <i class="fas fa-crown stats-icon"></i>
                        <h3 class="fw-bold mb-1">156</h3>
                        <p class="mb-0">Khách Hàng VIP</p>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="stats-card" style="background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); color: #333;">
                        <i class="fas fa-shopping-bag stats-icon"></i>
                        <h3 class="fw-bold mb-1">2,456</h3>
                        <p class="mb-0">Tổng Đơn Hàng</p>
                    </div>
                </div>
            </div>

            <!-- Filter Section -->
            <div class="filter-section">
                <h5 class="fw-semibold mb-3">
                    <i class="fas fa-filter me-2"></i>Bộ Lọc Tìm Kiếm
                </h5>
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <label class="form-label fw-semibold">Tìm kiếm khách hàng</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="fas fa-search"></i></span>
                            <input type="text" class="form-control" id="searchCustomer" placeholder="Tên, email, số điện thoại...">
                        </div>
                    </div>
                    <div class="col-md-2 mb-3">
                        <label class="form-label fw-semibold">Trạng thái</label>
                        <select class="form-select" id="statusFilter">
                            <option value="">Tất cả</option>
                            <option value="active">Hoạt động</option>
                            <option value="inactive">Không hoạt động</option>
                            <option value="vip">VIP</option>
                        </select>
                    </div>
                    <div class="col-md-2 mb-3">
                        <label class="form-label fw-semibold">Giới tính</label>
                        <select class="form-select" id="genderFilter">
                            <option value="">Tất cả</option>
                            <option value="male">Nam</option>
                            <option value="female">Nữ</option>
                            <option value="other">Khác</option>
                        </select>
                    </div>
                    <div class="col-md-2 mb-3">
                        <label class="form-label fw-semibold">Thành phố</label>
                        <select class="form-select" id="cityFilter">
                            <option value="">Tất cả</option>
                            <option value="hanoi">Hà Nội</option>
                            <option value="hcm">TP.HCM</option>
                            <option value="danang">Đà Nẵng</option>
                        </select>
                    </div>
                    <div class="col-md-3 mb-3">
                        <label class="form-label fw-semibold">Ngày đăng ký</label>
                        <div class="d-flex gap-2">
                            <input type="date" class="form-control" id="dateFrom">
                            <input type="date" class="form-control" id="dateTo">
                        </div>
                    </div>
                </div>
                <div class="d-flex gap-2">
                    <button class="btn btn-primary" onclick="applyFilters()">
                        <i class="fas fa-search me-2"></i>Tìm kiếm
                    </button>
                    <button class="btn btn-outline-secondary" onclick="resetFilters()">
                        <i class="fas fa-undo me-2"></i>Đặt lại
                    </button>
                </div>
            </div>

            <!-- Customer List -->
            <div class="card customer-card">
                <div class="card-header bg-white border-bottom">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="fw-semibold mb-0">
                            <i class="fas fa-list me-2"></i>Danh Sách Khách Hàng
                        </h5>
                        <div class="d-flex gap-2">
                            <button class="btn btn-outline-success btn-sm" onclick="exportCustomers()">
                                <i class="fas fa-download me-1"></i>Xuất Excel
                            </button>
                            <button class="btn btn-outline-primary btn-sm" onclick="refreshCustomers()">
                                <i class="fas fa-sync-alt me-1"></i>Làm mới
                            </button>
                        </div>
                    </div>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th class="border-0 fw-semibold">
                                        <input type="checkbox" class="form-check-input" id="selectAll">
                                    </th>
                                    <th class="border-0 fw-semibold">Khách Hàng</th>
                                    <th class="border-0 fw-semibold">Thông Tin Liên Hệ</th>
                                    <th class="border-0 fw-semibold">Địa Chỉ</th>
                                    <th class="border-0 fw-semibold">Thống Kê Mua Hàng</th>
                                    <th class="border-0 fw-semibold">Trạng Thái</th>
                                    <th class="border-0 fw-semibold">Ngày Đăng Ký</th>
                                    <th class="border-0 fw-semibold text-center">Thao Tác</th>
                                </tr>
                            </thead>
                            <tbody id="customerTableBody">
                                <!-- Customer rows will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="card-footer bg-white border-top">
                    <div class="d-flex justify-content-between align-items-center">
                        <div class="text-muted">
                            Hiển thị <span id="showingFrom">1</span> - <span id="showingTo">10</span> 
                            trong tổng số <span id="totalCustomers">1,247</span> khách hàng
                        </div>
                        <nav>
                            <ul class="pagination pagination-sm mb-0">
                                <li class="page-item"><a class="page-link" href="#" onclick="changePage(1)">1</a></li>
                                <li class="page-item active"><a class="page-link" href="#" onclick="changePage(2)">2</a></li>
                                <li class="page-item"><a class="page-link" href="#" onclick="changePage(3)">3</a></li>
                                <li class="page-item"><a class="page-link" href="#" onclick="changePage('next')">Tiếp</a></li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- View Customer Modal -->
<div class="modal fade" id="viewCustomerModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">
                    <i class="fas fa-user-circle me-2"></i>Thông Tin Chi Tiết Khách Hàng
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <!-- Customer Basic Info -->
                    <div class="col-md-4 mb-4">
                        <div class="customer-info-card text-center">
                            <div class="customer-avatar mb-3" style="width: 120px; height: 120px;">
                                <svg width="120" height="120" viewBox="0 0 120 120" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <circle cx="60" cy="60" r="60" fill="rgba(255,255,255,0.2)"/>
                                    <circle cx="60" cy="48" r="20" fill="white"/>
                                    <path d="M24 96c0-19.882 16.118-36 36-36s36 16.118 36 36" fill="white"/>
                                </svg>
                            </div>
                            <h4 class="fw-bold mb-2" id="viewCustomerName">Nguyễn Văn A</h4>
                            <p class="mb-3" id="viewCustomerEmail">nguyenvana@email.com</p>
                            <div class="info-item">
                                <i class="fas fa-phone me-2"></i>
                                <span id="viewCustomerPhone">0123456789</span>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-birthday-cake me-2"></i>
                                <span id="viewCustomerBirthday">15/03/1990</span>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-venus-mars me-2"></i>
                                <span id="viewCustomerGender">Nam</span>
                            </div>
                            <div class="info-item">
                                <i class="fas fa-calendar-alt me-2"></i>
                                <span>Đăng ký: </span><span id="viewCustomerJoinDate">12/01/2023</span>
                            </div>
                        </div>
                    </div>

                    <!-- Address Information -->
                    <div class="col-md-4 mb-4">
                        <div class="card h-100">
                            <div class="card-header bg-light">
                                <h6 class="fw-semibold mb-0">
                                    <i class="fas fa-map-marker-alt me-2"></i>Thông Tin Địa Chỉ
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="mb-3">
                                    <label class="fw-semibold text-muted">Địa chỉ chính:</label>
                                    <p class="mb-2" id="viewCustomerAddress">123 Đường ABC, Phường XYZ</p>
                                </div>
                                <div class="mb-3">
                                    <label class="fw-semibold text-muted">Quận/Huyện:</label>
                                    <p class="mb-2" id="viewCustomerDistrict">Quận 1</p>
                                </div>
                                <div class="mb-3">
                                    <label class="fw-semibold text-muted">Thành phố:</label>
                                    <p class="mb-2" id="viewCustomerCity">TP.HCM</p>
                                </div>
                                <div class="mb-3">
                                    <label class="fw-semibold text-muted">Mã bưu điện:</label>
                                    <p class="mb-0" id="viewCustomerPostalCode">70000</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Purchase Statistics -->
                    <div class="col-md-4 mb-4">
                        <div class="card h-100">
                            <div class="card-header bg-light">
                                <h6 class="fw-semibold mb-0">
                                    <i class="fas fa-chart-bar me-2"></i>Thống Kê Mua Hàng
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="row text-center mb-3">
                                    <div class="col-6">
                                        <div class="border rounded p-2">
                                            <h4 class="text-primary fw-bold mb-1" id="viewTotalOrders">24</h4>
                                            <small class="text-muted">Tổng đơn hàng</small>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="border rounded p-2">
                                            <h4 class="text-success fw-bold mb-1" id="viewTotalSpent">15,450,000₫</h4>
                                            <small class="text-muted">Tổng chi tiêu</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="row text-center mb-3">
                                    <div class="col-6">
                                        <div class="border rounded p-2">
                                            <h4 class="text-warning fw-bold mb-1" id="viewAvgOrderValue">643,750₫</h4>
                                            <small class="text-muted">Giá trị TB/đơn</small>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="border rounded p-2">
                                            <h4 class="text-info fw-bold mb-1" id="viewLastOrderDate">15/12/2023</h4>
                                            <small class="text-muted">Đơn hàng cuối</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="text-center">
                                    <span class="status-badge bg-success text-white" id="viewCustomerStatus">Khách hàng VIP</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Order History -->
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header bg-light">
                                <h6 class="fw-semibold mb-0">
                                    <i class="fas fa-history me-2"></i>Lịch Sử Đơn Hàng (5 đơn gần nhất)
                                </h6>
                            </div>
                            <div class="card-body">
                                <div id="orderHistoryList">
                                    <!-- Order history items will be populated by JavaScript -->
                                </div>
                                <div class="text-center mt-3">
                                    <button class="btn btn-outline-primary" onclick="viewAllOrders()">
                                        <i class="fas fa-eye me-2"></i>Xem Tất Cả Đơn Hàng
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                <button type="button" class="btn btn-primary" onclick="editCustomer()">
                    <i class="fas fa-edit me-2"></i>Chỉnh Sửa
                </button>
                <button type="button" class="btn btn-success" onclick="sendEmail()">
                    <i class="fas fa-envelope me-2"></i>Gửi Email
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Add/Edit Customer Modal -->
<div class="modal fade" id="addCustomerModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title">
                    <i class="fas fa-user-plus me-2"></i>Thêm Khách Hàng Mới
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="customerForm">
                    <div class="row">
                        <!-- Personal Information -->
                        <div class="col-md-6">
                            <h6 class="fw-semibold text-primary mb-3">
                                <i class="fas fa-user me-2"></i>Thông Tin Cá Nhân
                            </h6>
                            <div class="mb-3">
                                <label class="form-label fw-semibold">Họ và tên <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="customerName" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label fw-semibold">Email <span class="text-danger">*</span></label>
                                <input type="email" class="form-control" id="customerEmail" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label fw-semibold">Số điện thoại <span class="text-danger">*</span></label>
                                <input type="tel" class="form-control" id="customerPhone" required>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-semibold">Ngày sinh</label>
                                    <input type="date" class="form-control" id="customerBirthday">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-semibold">Giới tính</label>
                                    <select class="form-select" id="customerGender">
                                        <option value="">Chọn giới tính</option>
                                        <option value="male">Nam</option>
                                        <option value="female">Nữ</option>
                                        <option value="other">Khác</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Address Information -->
                        <div class="col-md-6">
                            <h6 class="fw-semibold text-primary mb-3">
                                <i class="fas fa-map-marker-alt me-2"></i>Thông Tin Địa Chỉ
                            </h6>
                            <div class="mb-3">
                                <label class="form-label fw-semibold">Địa chỉ <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="customerAddress" required>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-semibold">Quận/Huyện</label>
                                    <input type="text" class="form-control" id="customerDistrict">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label fw-semibold">Thành phố <span class="text-danger">*</span></label>
                                    <select class="form-select" id="customerCity" required>
                                        <option value="">Chọn thành phố</option>
                                        <option value="hanoi">Hà Nội</option>
                                        <option value="hcm">TP.HCM</option>
                                        <option value="danang">Đà Nẵng</option>
                                        <option value="haiphong">Hải Phòng</option>
                                        <option value="cantho">Cần Thơ</option>
                                    </select>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label fw-semibold">Mã bưu điện</label>
                                <input type="text" class="form-control" id="customerPostalCode">
                            </div>
                            <div class="mb-3">
                                <label class="form-label fw-semibold">Trạng thái</label>
                                <select class="form-select" id="customerStatus">
                                    <option value="active">Hoạt động</option>
                                    <option value="inactive">Không hoạt động</option>
                                    <option value="vip">VIP</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Additional Information -->
                    <div class="row">
                        <div class="col-12">
                            <h6 class="fw-semibold text-primary mb-3">
                                <i class="fas fa-info-circle me-2"></i>Thông Tin Bổ Sung
                            </h6>
                            <div class="mb-3">
                                <label class="form-label fw-semibold">Ghi chú</label>
                                <textarea class="form-control" id="customerNotes" rows="3" placeholder="Ghi chú về khách hàng..."></textarea>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-success" onclick="saveCustomer()">
                    <i class="fas fa-save me-2"></i>Lưu Khách Hàng
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Customer Modal -->
<div class="modal fade" id="deleteCustomerModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title">
                    <i class="fas fa-exclamation-triangle me-2"></i>Xác Nhận Xóa Khách Hàng
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <strong>Cảnh báo!</strong> Hành động này không thể hoàn tác.
                </div>
                
                <p>Bạn có chắc chắn muốn xóa khách hàng <strong id="deleteCustomerName">Nguyễn Văn A</strong>?</p>
                
                <div class="bg-light p-3 rounded mb-3">
                    <h6 class="fw-semibold mb-2">Dữ liệu sẽ bị xóa:</h6>
                    <ul class="mb-0">
                        <li>Thông tin cá nhân của khách hàng</li>
                        <li>Lịch sử đơn hàng (<span id="deleteCustomerOrders">24</span> đơn)</li>
                        <li>Địa chỉ giao hàng</li>
                        <li>Ghi chú và nhận xét</li>
                    </ul>
                </div>

                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="confirmDelete">
                    <label class="form-check-label fw-semibold" for="confirmDelete">
                        Tôi hiểu và xác nhận xóa khách hàng này
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                <button type="button" class="btn btn-danger" id="confirmDeleteBtn" onclick="confirmDeleteCustomer()" disabled>
                    <i class="fas fa-trash me-2"></i>Xóa Khách Hàng
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<script src="js/include.js"></script>
<script src="js/admin.js"></script>
<script>
// Sample customer data
const sampleCustomers = [
    {
        id: 1,
        name: "Nguyễn Văn A",
        email: "nguyenvana@email.com",
        phone: "0123456789",
        address: "123 Đường ABC, Phường XYZ",
        district: "Quận 1",
        city: "TP.HCM",
        postalCode: "70000",
        birthday: "1990-03-15",
        gender: "Nam",
        status: "vip",
        joinDate: "2023-01-12",
        totalOrders: 24,
        totalSpent: 15450000,
        lastOrderDate: "2023-12-15",
        avatar: "https://via.placeholder.com/50"
    },
    {
        id: 2,
        name: "Trần Thị B",
        email: "tranthib@email.com",
        phone: "0987654321",
        address: "456 Đường DEF, Phường UVW",
        district: "Quận 3",
        city: "TP.HCM",
        postalCode: "70000",
        birthday: "1985-07-22",
        gender: "Nữ",
        status: "active",
        joinDate: "2023-03-08",
        totalOrders: 12,
        totalSpent: 8750000,
        lastOrderDate: "2023-12-10",
        avatar: "https://via.placeholder.com/50"
    },
    {
        id: 3,
        name: "Lê Văn C",
        email: "levanc@email.com",
        phone: "0369852147",
        address: "789 Đường GHI, Phường RST",
        district: "Quận 7",
        city: "TP.HCM",
        postalCode: "70000",
        birthday: "1992-11-30",
        gender: "Nam",
        status: "active",
        joinDate: "2023-05-20",
        totalOrders: 8,
        totalSpent: 4200000,
        lastOrderDate: "2023-12-05",
        avatar: "https://via.placeholder.com/50"
    }
];

// Sample order history
const sampleOrderHistory = [
    {
        id: "DH001",
        date: "2023-12-15",
        total: 1250000,
        status: "Đã giao",
        items: 3
    },
    {
        id: "DH002",
        date: "2023-12-10",
        total: 890000,
        status: "Đang giao",
        items: 2
    },
    {
        id: "DH003",
        date: "2023-12-05",
        total: 2100000,
        status: "Đã giao",
        items: 5
    }
];

// Initialize page
document.addEventListener('DOMContentLoaded', function() {
    loadCustomers();
    initializeEventListeners();
});

function initializeEventListeners() {
    // Select all checkbox
    document.getElementById('selectAll').addEventListener('change', function() {
        const checkboxes = document.querySelectorAll('tbody input[type="checkbox"]');
        checkboxes.forEach(cb => cb.checked = this.checked);
    });

    // Confirm delete checkbox
    document.getElementById('confirmDelete').addEventListener('change', function() {
        document.getElementById('confirmDeleteBtn').disabled = !this.checked;
    });

    // Search functionality
    document.getElementById('searchCustomer').addEventListener('input', function() {
        filterCustomers();
    });
}

function loadCustomers() {
    const tbody = document.getElementById('customerTableBody');
    tbody.innerHTML = '';

    sampleCustomers.forEach(customer => {
        const row = createCustomerRow(customer);
        tbody.appendChild(row);
    });
}

function createCustomerRow(customer) {
    const tr = document.createElement('tr');
    
    const statusClass = customer.status === 'vip' ? 'bg-warning text-dark' : 
                       customer.status === 'active' ? 'bg-success' : 'bg-secondary';
    const statusText = customer.status === 'vip' ? 'VIP' : 
                      customer.status === 'active' ? 'Hoạt động' : 'Không hoạt động';

    tr.innerHTML = `
        <td>
            <input type="checkbox" class="form-check-input" value="${customer.id}">
        </td>
        <td>
            <div class="d-flex align-items-center">
                <div class="customer-avatar me-3">
                    <svg width="50" height="50" viewBox="0 0 50 50" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="25" cy="25" r="25" fill="#e3f2fd"/>
                        <circle cx="25" cy="20" r="8" fill="#1976d2"/>
                        <path d="M10 40c0-8.284 6.716-15 15-15s15 6.716 15 15" fill="#1976d2"/>
                    </svg>
                </div>
                <div>
                    <div class="fw-semibold">${customer.name}</div>
                    <small class="text-muted">ID: #${customer.id.toString().padStart(4, '0')}</small>
                </div>
            </div>
        </td>
        <td>
            <div>
                <div class="fw-semibold">${customer.email}</div>
                <small class="text-muted">
                    <i class="fas fa-phone me-1"></i>${customer.phone}
                </small>
            </div>
        </td>
        <td>
            <div>
                <div class="fw-semibold">${customer.address}</div>
                <small class="text-muted">${customer.district}, ${customer.city}</small>
            </div>
        </td>
        <td>
            <div class="text-center">
                <div class="fw-bold text-primary">${customer.totalOrders} đơn</div>
                <small class="text-success">${formatCurrency(customer.totalSpent)}</small>
            </div>
        </td>
        <td>
            <span class="status-badge ${statusClass}">${statusText}</span>
        </td>
        <td>
            <div class="fw-semibold">${formatDate(customer.joinDate)}</div>
            <small class="text-muted">Đơn cuối: ${formatDate(customer.lastOrderDate)}</small>
        </td>
        <td>
            <div class="d-flex gap-1 justify-content-center">
                <button class="btn btn-outline-primary btn-sm" onclick="viewCustomer(${customer.id})" title="Xem chi tiết">
                    <i class="fas fa-eye"></i>
                </button>
                <button class="btn btn-outline-success btn-sm" onclick="editCustomer(${customer.id})" title="Chỉnh sửa">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-outline-danger btn-sm" onclick="deleteCustomer(${customer.id})" title="Xóa">
                    <i class="fas fa-trash"></i>
                </button>
                <button class="btn btn-outline-info btn-sm" onclick="sendEmail(${customer.id})" title="Gửi email">
                    <i class="fas fa-envelope"></i>
                </button>
            </div>
        </td>
    `;

    return tr;
}

function viewCustomer(id) {
    const customer = sampleCustomers.find(c => c.id === id);
    if (!customer) return;

    // Populate modal with customer data
    document.getElementById('viewCustomerName').textContent = customer.name;
    document.getElementById('viewCustomerEmail').textContent = customer.email;
    document.getElementById('viewCustomerPhone').textContent = customer.phone;
    document.getElementById('viewCustomerBirthday').textContent = formatDate(customer.birthday);
    document.getElementById('viewCustomerGender').textContent = customer.gender;
    document.getElementById('viewCustomerJoinDate').textContent = formatDate(customer.joinDate);
    document.getElementById('viewCustomerAddress').textContent = customer.address;
    document.getElementById('viewCustomerDistrict').textContent = customer.district;
    document.getElementById('viewCustomerCity').textContent = customer.city;
    document.getElementById('viewCustomerPostalCode').textContent = customer.postalCode;
    document.getElementById('viewTotalOrders').textContent = customer.totalOrders;
    document.getElementById('viewTotalSpent').textContent = formatCurrency(customer.totalSpent);
    document.getElementById('viewAvgOrderValue').textContent = formatCurrency(customer.totalSpent / customer.totalOrders);
    document.getElementById('viewLastOrderDate').textContent = formatDate(customer.lastOrderDate);

    // Load order history
    loadOrderHistory();

    const modal = new bootstrap.Modal(document.getElementById('viewCustomerModal'));
    modal.show();
}

function loadOrderHistory() {
    const container = document.getElementById('orderHistoryList');
    container.innerHTML = '';

    sampleOrderHistory.forEach(order => {
        const orderItem = document.createElement('div');
        orderItem.className = 'order-history-item';
        orderItem.innerHTML = `
            <div class="d-flex justify-content-between align-items-start">
                <div>
                    <h6 class="fw-bold mb-1">Đơn hàng #${order.id}</h6>
                    <p class="text-muted mb-2">
                        <i class="fas fa-calendar me-1"></i>${formatDate(order.date)} • 
                        <i class="fas fa-box me-1"></i>${order.items} sản phẩm
                    </p>
                </div>
                <div class="text-end">
                    <div class="fw-bold text-success">${formatCurrency(order.total)}</div>
                    <span class="badge bg-success">${order.status}</span>
                </div>
            </div>
        `;
        container.appendChild(orderItem);
    });
}

function editCustomer(id) {
    const customer = sampleCustomers.find(c => c.id === id);
    if (!customer) return;

    // Populate form with customer data
    document.getElementById('customerName').value = customer.name;
    document.getElementById('customerEmail').value = customer.email;
    document.getElementById('customerPhone').value = customer.phone;
    document.getElementById('customerAddress').value = customer.address;
    document.getElementById('customerDistrict').value = customer.district;
    document.getElementById('customerCity').value = customer.city;
    document.getElementById('customerPostalCode').value = customer.postalCode;
    document.getElementById('customerBirthday').value = customer.birthday;
    document.getElementById('customerGender').value = customer.gender === 'Nam' ? 'male' : 'female';
    document.getElementById('customerStatus').value = customer.status;

    // Change modal title
    document.querySelector('#addCustomerModal .modal-title').innerHTML = 
        '<i class="fas fa-edit me-2"></i>Chỉnh Sửa Khách Hàng';
    document.querySelector('#addCustomerModal .modal-header').className = 'modal-header bg-primary text-white';

    const modal = new bootstrap.Modal(document.getElementById('addCustomerModal'));
    modal.show();
}

function deleteCustomer(id) {
    const customer = sampleCustomers.find(c => c.id === id);
    if (!customer) return;

    document.getElementById('deleteCustomerName').textContent = customer.name;
    document.getElementById('deleteCustomerOrders').textContent = customer.totalOrders;
    document.getElementById('confirmDelete').checked = false;
    document.getElementById('confirmDeleteBtn').disabled = true;

    const modal = new bootstrap.Modal(document.getElementById('deleteCustomerModal'));
    modal.show();
}

function saveCustomer() {
    // Show loading
    const btn = event.target;
    const originalText = btn.innerHTML;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Đang lưu...';
    btn.disabled = true;

    // Simulate API call
    setTimeout(() => {
        btn.innerHTML = originalText;
        btn.disabled = false;
        
        // Show success toast
        showToast('Thành công!', 'Khách hàng đã được lưu thành công.', 'success');
        
        // Close modal
        bootstrap.Modal.getInstance(document.getElementById('addCustomerModal')).hide();
        
        // Reload customers
        loadCustomers();
    }, 1500);
}

function confirmDeleteCustomer() {
    // Show loading
    const btn = document.getElementById('confirmDeleteBtn');
    const originalText = btn.innerHTML;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Đang xóa...';
    btn.disabled = true;

    // Simulate API call
    setTimeout(() => {
        btn.innerHTML = originalText;
        btn.disabled = false;
        
        // Show success toast
        showToast('Đã xóa!', 'Khách hàng đã được xóa thành công.', 'success');
        
        // Close modal
        bootstrap.Modal.getInstance(document.getElementById('deleteCustomerModal')).hide();
        
        // Reload customers
        loadCustomers();
    }, 1500);
}

function sendEmail(id) {
    showToast('Email đã gửi!', 'Email đã được gửi đến khách hàng thành công.', 'info');
}

function applyFilters() {
    filterCustomers();
    showToast('Đã áp dụng bộ lọc!', 'Kết quả tìm kiếm đã được cập nhật.', 'info');
}

function resetFilters() {
    document.getElementById('searchCustomer').value = '';
    document.getElementById('statusFilter').value = '';
    document.getElementById('genderFilter').value = '';
    document.getElementById('cityFilter').value = '';
    document.getElementById('dateFrom').value = '';
    document.getElementById('dateTo').value = '';
    
    loadCustomers();
    showToast('Đã đặt lại bộ lọc!', 'Tất cả bộ lọc đã được xóa.', 'info');
}

function filterCustomers() {
    const searchTerm = document.getElementById('searchCustomer').value.toLowerCase();
    const statusFilter = document.getElementById('statusFilter').value;
    const genderFilter = document.getElementById('genderFilter').value;
    const cityFilter = document.getElementById('cityFilter').value;

    let filteredCustomers = sampleCustomers.filter(customer => {
        const matchesSearch = customer.name.toLowerCase().includes(searchTerm) ||
                            customer.email.toLowerCase().includes(searchTerm) ||
                            customer.phone.includes(searchTerm);
        
        const matchesStatus = !statusFilter || customer.status === statusFilter;
        const matchesGender = !genderFilter || 
                            (genderFilter === 'male' && customer.gender === 'Nam') ||
                            (genderFilter === 'female' && customer.gender === 'Nữ');
        const matchesCity = !cityFilter || customer.city.toLowerCase().includes(cityFilter);

        return matchesSearch && matchesStatus && matchesGender && matchesCity;
    });

    // Update table
    const tbody = document.getElementById('customerTableBody');
    tbody.innerHTML = '';
    filteredCustomers.forEach(customer => {
        const row = createCustomerRow(customer);
        tbody.appendChild(row);
    });
}

function exportCustomers() {
    showToast('Đang xuất dữ liệu...', 'File Excel sẽ được tải xuống trong giây lát.', 'info');
}

function refreshCustomers() {
    loadCustomers();
    showToast('Đã làm mới!', 'Danh sách khách hàng đã được cập nhật.', 'success');
}

function changePage(page) {
    // Pagination logic here
    showToast('Đã chuyển trang!', `Đã chuyển đến trang ${page}.`, 'info');
}

function viewAllOrders() {
    showToast('Chuyển hướng...', 'Đang chuyển đến trang quản lý đơn hàng.', 'info');
}

// Utility functions
function formatCurrency(amount) {
    return new Intl.NumberFormat('vi-VN', {
        style: 'currency',
        currency: 'VND'
    }).format(amount);
}

function formatDate(dateString) {
    return new Date(dateString).toLocaleDateString('vi-VN');
}

function showToast(title, message, type = 'info') {
    // Create toast element
    const toastHtml = `
        <div class="toast align-items-center text-white bg-${type === 'success' ? 'success' : type === 'error' ? 'danger' : 'info'} border-0" role="alert">
            <div class="d-flex">
                <div class="toast-body">
                    <strong>${title}</strong><br>${message}
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
            </div>
        </div>
    `;

    // Add to toast container
    let toastContainer = document.querySelector('.toast-container');
    if (!toastContainer) {
        toastContainer = document.createElement('div');
        toastContainer.className = 'toast-container position-fixed top-0 end-0 p-3';
        document.body.appendChild(toastContainer);
    }

    toastContainer.insertAdjacentHTML('beforeend', toastHtml);
    const toastElement = toastContainer.lastElementChild;
    const toast = new bootstrap.Toast(toastElement);
    toast.show();

    // Remove toast element after it's hidden
    toastElement.addEventListener('hidden.bs.toast', () => {
        toastElement.remove();
    });
}
</script>
</body>
</html>